{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the RehnumaAI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Display name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document uploaded by a user, such as a textbook page or past paper.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the document entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Document)"
        },
        "fileName": {
          "type": "string",
          "description": "Name of the uploaded file."
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the document was uploaded.",
          "format": "date-time"
        },
        "fileType": {
          "type": "string",
          "description": "Type of the uploaded file (e.g., PDF, image)."
        },
        "storagePath": {
          "type": "string",
          "description": "Path to the document stored in Firebase Storage."
        }
      },
      "required": [
        "id",
        "userId",
        "fileName",
        "uploadDate",
        "fileType",
        "storagePath"
      ]
    },
    "AiExplanation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiExplanation",
      "type": "object",
      "description": "Represents an AI-generated explanation for a portion of a document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI explanation entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to Document. (Relationship: Document 1:N AiExplanation)"
        },
        "textSegment": {
          "type": "string",
          "description": "The text segment from the document that the explanation is for."
        },
        "explanation": {
          "type": "string",
          "description": "The AI-generated explanation for the text segment."
        },
        "language": {
          "type": "string",
          "description": "Language of the AI-generated explanation (e.g., Urdu, English)."
        },
        "explanationDate": {
          "type": "string",
          "description": "Date and time when the explanation was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "documentId",
        "textSegment",
        "explanation",
        "language",
        "explanationDate"
      ]
    },
    "PracticeQuestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PracticeQuestion",
      "type": "object",
      "description": "Represents a practice question generated by AI for a document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the practice question entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to Document. (Relationship: Document 1:N PracticeQuestion)"
        },
        "questionText": {
          "type": "string",
          "description": "The text of the practice question."
        },
        "answer": {
          "type": "string",
          "description": "The correct answer to the practice question."
        },
        "difficulty": {
          "type": "string",
          "description": "Difficulty level of the practice question (e.g., Easy, Medium, Hard)."
        },
        "questionDate": {
          "type": "string",
          "description": "Date and time when the question was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "documentId",
        "questionText",
        "answer",
        "difficulty",
        "questionDate"
      ]
    },
    "Summary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Summary",
      "type": "object",
      "description": "Represents a summary of a document generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the summary entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to Document. (Relationship: Document 1:N Summary)"
        },
        "summaryText": {
          "type": "string",
          "description": "The text of the AI-generated summary."
        },
        "summaryDate": {
          "type": "string",
          "description": "Date and time when the summary was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "documentId",
        "summaryText",
        "summaryDate"
      ]
    },
    "RevisionPrompt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RevisionPrompt",
      "type": "object",
      "description": "Represents a revision prompt generated by AI for a document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the revision prompt entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to Document. (Relationship: Document 1:N RevisionPrompt)"
        },
        "promptText": {
          "type": "string",
          "description": "The text of the AI-generated revision prompt."
        },
        "promptDate": {
          "type": "string",
          "description": "Date and time when the revision prompt was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "documentId",
        "promptText",
        "promptDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. This is private data, accessible only to the user and admins (if applicable).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores documents uploaded by the user. This is private data, accessible only to the user who uploaded the document. Includes 'userId' to enforce ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/aiExplanations/{aiExplanationId}",
        "definition": {
          "entityName": "AiExplanation",
          "schema": {
            "$ref": "#/backend/entities/AiExplanation"
          },
          "description": "Stores AI-generated explanations for a specific document. This is private data, accessible only to the user who owns the document. Includes denormalized 'userId' from the parent document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "aiExplanationId",
              "description": "The unique identifier for the AI explanation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/practiceQuestions/{practiceQuestionId}",
        "definition": {
          "entityName": "PracticeQuestion",
          "schema": {
            "$ref": "#/backend/entities/PracticeQuestion"
          },
          "description": "Stores practice questions generated by AI for a specific document. This is private data, accessible only to the user who owns the document. Includes denormalized 'userId' from the parent document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "practiceQuestionId",
              "description": "The unique identifier for the practice question."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/summaries/{summaryId}",
        "definition": {
          "entityName": "Summary",
          "schema": {
            "$ref": "#/backend/entities/Summary"
          },
          "description": "Stores AI-generated summaries for a specific document. This is private data, accessible only to the user who owns the document. Includes denormalized 'userId' from the parent document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "summaryId",
              "description": "The unique identifier for the summary."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/revisionPrompts/{revisionPromptId}",
        "definition": {
          "entityName": "RevisionPrompt",
          "schema": {
            "$ref": "#/backend/entities/RevisionPrompt"
          },
          "description": "Stores AI-generated revision prompts for a specific document. This is private data, accessible only to the user who owns the document. Includes denormalized 'userId' from the parent document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "revisionPromptId",
              "description": "The unique identifier for the revision prompt."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. User data is stored under `/users/{userId}` ensuring path-based ownership. Documents, AI Explanations, Practice Questions, Summaries, and Revision Prompts are stored as subcollections under `/users/{userId}/documents/{documentId}`. This structure establishes clear ownership and avoids the need for complex `get()` calls in security rules. This promotes Authorization Independence, as access control is determined by the path itself and the user's authentication status. Every document is implicitly owned by the user ID present in the path.\n\nThis structure supports QAPs because list operations are naturally scoped to a user's documents. There is no need to filter based on ownership within the rules, because the path itself defines ownership. Segregation of data based on ownership, via path-based access, ensures that users can only access their own documents and associated data.\n\nTimestamps should be enforced using server timestamps on creation. If an entity can be updated, consider enforcing timestamp updates on any write."
  }
}
    